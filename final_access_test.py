#!/usr/bin/env python3
"""
–§–ò–ù–ê–õ–¨–ù–´–ô –¢–ï–°–¢ –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù–ù–û–ô –°–ò–°–¢–ï–ú–´
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Å—Ç–∞—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
"""

import sys
import time
import os

sys.path.insert(0, './utils')
sys.path.insert(0, './admin_bot')

def test_integrated_system():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É"""
    print("üîß –¢–ï–°–¢ –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù–ù–û–ô –°–ò–°–¢–ï–ú–´")
    print("=" * 80)
    
    user_id = 6626270112
    
    try:
        # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç–∞—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É)
        from utils.access_manager import has_access, add_user_access, remove_user_access, delete_user_completely, force_sync_access
        
        print("‚úÖ –ò–º–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π —É—Å–ø–µ—à–µ–Ω")
        
        # 1. –ù–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        print(f"\n1Ô∏è‚É£ –ù–ê–ß–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï:")
        initial_access = has_access(user_id)
        print(f"   has_access({user_id}): {initial_access}")
        
        # 2. –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        print(f"\n2Ô∏è‚É£ –î–û–ë–ê–í–õ–Ø–ï–ú –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:")
        add_result = add_user_access(user_id)
        print(f"   add_user_access({user_id}): {add_result}")
        
        # –°—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø
        access_after_add = has_access(user_id)
        print(f"   has_access({user_id}) —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: {access_after_add}")
        
        # 3. –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        print(f"\n3Ô∏è‚É£ –£–î–ê–õ–Ø–ï–ú –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:")
        remove_result = delete_user_completely(user_id)
        print(f"   delete_user_completely({user_id}): {remove_result}")
        
        # –°—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø
        access_after_remove = has_access(user_id)
        print(f"   has_access({user_id}) —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è: {access_after_remove}")
        
        # 4. –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
        print(f"\n4Ô∏è‚É£ –¢–ï–°–¢–ò–†–£–ï–ú –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Æ:")
        sync_result = force_sync_access()
        print(f"   force_sync_access(): {sync_result}")
        
        # 5. –†–µ–∑—É–ª—å—Ç–∞—Ç
        print(f"\nüèÅ –†–ï–ó–£–õ–¨–¢–ê–¢ –¢–ï–°–¢–ê:")
        print(f"   –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: {initial_access}")
        print(f"   –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: {access_after_add}")
        print(f"   –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è: {access_after_remove}")
        
        if not initial_access and access_after_add and not access_after_remove:
            print(f"\nüéâ –°–ò–°–¢–ï–ú–ê –†–ê–ë–û–¢–ê–ï–¢ –ò–î–ï–ê–õ–¨–ù–û!")
            print(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ: –º–≥–Ω–æ–≤–µ–Ω–Ω–æ")
            print(f"   ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ: –º–≥–Ω–æ–≤–µ–Ω–Ω–æ")
            print(f"   ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è")
            return True
        else:
            print(f"\n‚ùå –ï–°–¢–¨ –ü–†–û–ë–õ–ï–ú–´:")
            if initial_access:
                print(f"   ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –≤ —Å–∏—Å—Ç–µ–º–µ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ")
            if not access_after_add:
                print(f"   ‚ùå –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ")
            if access_after_remove:
                print(f"   ‚ùå –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ")
            return False
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {e}")
        import traceback
        traceback.print_exc()
        return False

def simulate_admin_bot_operations():
    """–°–∏–º—É–ª–∏—Ä—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞–¥–º–∏–Ω –±–æ—Ç–∞"""
    print(f"\nü§ñ –°–ò–ú–£–õ–Ø–¶–ò–Ø –û–ü–ï–†–ê–¶–ò–ô –ê–î–ú–ò–ù –ë–û–¢–ê")
    print("=" * 80)
    
    user_id = 6626270112
    
    try:
        # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–¥–º–∏–Ω –±–æ—Ç
        from utils.access_manager import add_user_access, delete_user_completely, has_access
        
        print(f"üìã –°–∏–º—É–ª–∏—Ä—É–µ–º —Å—Ü–µ–Ω–∞—Ä–∏–π:")
        print(f"   1. –ê–¥–º–∏–Ω –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
        print(f"   2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
        print(f"   3. –ê–¥–º–∏–Ω —É–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
        print(f"   4. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –ù–ï –≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
        
        # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–∞–∫ –∞–¥–º–∏–Ω –±–æ—Ç)
        print(f"\nüü¢ –ê–î–ú–ò–ù: –î–æ–±–∞–≤–ª—è—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")
        add_result = add_user_access(user_id)
        print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {add_result}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø (–∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç)
        print(f"ü§ñ –û–°–ù–û–í–ù–û–ô –ë–û–¢: –ü—Ä–æ–≤–µ—Ä—è—é –¥–æ—Å—Ç—É–ø –¥–ª—è {user_id}")
        access_result = has_access(user_id)
        print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {access_result}")
        
        if access_result:
            print(f"   ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –í–ò–î–ò–¢ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!")
        else:
            print(f"   ‚ùå –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –ù–ï –í–ò–î–ò–¢ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!")
        
        # –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ
        time.sleep(0.5)
        
        # –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–∞–∫ –∞–¥–º–∏–Ω –±–æ—Ç)
        print(f"\nüî¥ –ê–î–ú–ò–ù: –£–¥–∞–ª—è—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")
        remove_result = delete_user_completely(user_id)
        print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {remove_result}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø (–∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç)
        print(f"ü§ñ –û–°–ù–û–í–ù–û–ô –ë–û–¢: –ü—Ä–æ–≤–µ—Ä—è—é –¥–æ—Å—Ç—É–ø –¥–ª—è {user_id}")
        access_result_after = has_access(user_id)
        print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {access_result_after}")
        
        if not access_result_after:
            print(f"   ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –ù–ï –í–ò–î–ò–¢ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!")
        else:
            print(f"   ‚ùå –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –í–°–ï –ï–©–ï –í–ò–î–ò–¢ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!")
        
        return access_result and not access_result_after
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏: {e}")
        return False

def main():
    print("üöÄ –§–ò–ù–ê–õ–¨–ù–´–ô –¢–ï–°–¢ –ù–û–í–û–ô –°–ò–°–¢–ï–ú–´ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò")
    print("=" * 100)
    
    # –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ—Å—Ç
    basic_test_result = test_integrated_system()
    
    # –°–∏–º—É–ª—è—Ü–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
    simulation_result = simulate_admin_bot_operations()
    
    print(f"\nüèÜ –§–ò–ù–ê–õ–¨–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´:")
    print("=" * 100)
    print(f"   –ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç: {'‚úÖ –ü–†–û–®–ï–õ' if basic_test_result else '‚ùå –ù–ï –ü–†–û–®–ï–õ'}")
    print(f"   –°–∏–º—É–ª—è—Ü–∏—è –∞–¥–º–∏–Ω –±–æ—Ç–∞: {'‚úÖ –ü–†–û–®–ï–õ' if simulation_result else '‚ùå –ù–ï –ü–†–û–®–ï–õ'}")
    
    if basic_test_result and simulation_result:
        print(f"\nüéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!")
        print(f"üöÄ –ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò –ì–û–¢–û–í–ê –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ!")
        print(f"üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∞–¥–º–∏–Ω –±–æ—Ç –∏ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π")
        print(f"üìñ –ß–∏—Ç–∞–π—Ç–µ MIGRATION_GUIDE.md –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π")
    else:
        print(f"\n‚ö†Ô∏è –ï–°–¢–¨ –ü–†–û–ë–õ–ï–ú–´!")
        print(f"üîß –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ")
        print(f"üîÑ –í–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–µ–Ω rollback –∏–∑ backup_old_sync/")

if __name__ == "__main__":
    main() 